---
title: 'å‰ç«¯æ¨¡å—åŒ–ä¸åŒ…ç®¡ç†æ·±åº¦è§£æ: ä» CommonJS åˆ° ESM çš„æ¼”è¿›ä¹‹è·¯'
titleEn: 'Deep Dive into Frontend Modularization and Package Management: Evolution from CommonJS to ESM'
summary: 'æ·±å…¥æ¢è®¨JavaScriptæ¨¡å—åŒ–ç³»ç»Ÿçš„å‘å±•å†ç¨‹ï¼Œä»CommonJSã€AMDåˆ°ES6 Modulesï¼Œä»¥åŠç°ä»£åŒ…ç®¡ç†å·¥å…·npmã€yarnã€pnpmçš„åŸç†ä¸å®è·µã€‚æ¶µç›–æ‰“åŒ…å·¥å…·çš„å·¥ä½œæœºåˆ¶å’Œæ€§èƒ½ä¼˜åŒ–ç­–ç•¥ã€‚'
summaryEn: 'In-depth exploration of JavaScript modularization system evolution, from CommonJS and AMD to ES6 Modules, and modern package management tools npm, yarn, pnpm principles and practices. Covers bundling tools mechanisms and performance optimization strategies.'
date: '2025-09-10'
lastmod: '2025-12-25'
tags: ['javascript', 'nodejs', 'vite', 'webpack', 'npm', 'module']
draft: false
---

å‰ç«¯å¼€å‘çš„å¤æ‚åº¦éšç€åº”ç”¨è§„æ¨¡çš„å¢é•¿è€Œæ€¥å‰§ä¸Šå‡ã€‚å¦‚ä½•æœ‰æ•ˆåœ°ç»„ç»‡ä»£ç ã€ç®¡ç†ä¾èµ–ã€å¤ç”¨åŠŸèƒ½æ¨¡å—ï¼Œæˆä¸ºæ¯ä¸ªå‰ç«¯å·¥ç¨‹å¸ˆå¿…é¡»é¢å¯¹çš„æ ¸å¿ƒé—®é¢˜ã€‚æ¨¡å—åŒ–å’ŒåŒ…ç®¡ç†æ­£æ˜¯è§£å†³è¿™äº›é—®é¢˜çš„å…³é”®æŠ€æœ¯ã€‚

æœ¬æ–‡å°†å¸¦ä½ æ·±å…¥äº†è§£ JavaScript æ¨¡å—åŒ–ç³»ç»Ÿçš„å‘å±•å†ç¨‹ï¼Œæ¢è®¨å„ç§æ¨¡å—è§„èŒƒçš„ç‰¹ç‚¹ä¸é€‚ç”¨åœºæ™¯ï¼Œå¹¶æ·±å…¥åˆ†æç°ä»£åŒ…ç®¡ç†å·¥å…·çš„å·¥ä½œåŸç†å’Œæœ€ä½³å®è·µã€‚

---

## JavaScript æ¨¡å—åŒ–çš„å‘å±•å†ç¨‹

### æ—©æœŸçš„æ¨¡å—åŒ–å°è¯•

åœ¨ ES6 æ­£å¼å¼•å…¥æ¨¡å—ç³»ç»Ÿä¹‹å‰ï¼ŒJavaScript æœ¬èº«å¹¶ä¸æ”¯æŒæ¨¡å—åŒ–ã€‚å¼€å‘è€…ä»¬é€šè¿‡å„ç§æ–¹å¼æ¥æ¨¡æ‹Ÿæ¨¡å—åŠŸèƒ½ã€‚

**ç«‹å³æ‰§è¡Œå‡½æ•°è¡¨è¾¾å¼ (IIFE)**

```javascript
// æ—©æœŸçš„æ¨¡å—åŒ–æ¨¡å¼
var MyModule = (function () {
  var privateVar = "Hello World";

  function privateFunction() {
    console.log(privateVar);
  }

  return {
    publicMethod: function () {
      privateFunction();
    },
    publicVar: "Public",
  };
})();

MyModule.publicMethod(); // Hello World
```

**å‘½åç©ºé—´æ¨¡å¼**

```javascript
// å…¨å±€å‘½åç©ºé—´
var APP = APP || {};
APP.utils = {};
APP.components = {};

APP.utils.formatDate = function (date) {
  return date.toISOString().split("T")[0];
};
```

è¿™äº›æ—©æœŸæ–¹æ¡ˆå­˜åœ¨æ˜æ˜¾ç¼ºé™·ï¼š

- å…¨å±€å˜é‡æ±¡æŸ“
- ä¾èµ–å…³ç³»ä¸æ˜ç¡®
- ç¼ºä¹æ ‡å‡†åŒ–
- éš¾ä»¥è¿›è¡Œé™æ€åˆ†æ

### CommonJSï¼šNode.js çš„æ¨¡å—ç³»ç»Ÿ

CommonJS æ˜¯ Node.js é‡‡ç”¨çš„æ¨¡å—è§„èŒƒï¼Œä¸ºæœåŠ¡ç«¯ JavaScript æä¾›äº†æ ‡å‡†çš„æ¨¡å—åŒ–è§£å†³æ–¹æ¡ˆã€‚

**åŸºæœ¬è¯­æ³•**

```javascript
// math.js - å¯¼å‡ºæ¨¡å—
const PI = 3.14159;

function add(a, b) {
  return a + b;
}

function multiply(a, b) {
  return a * b;
}

// å•ä¸ªå¯¼å‡º
module.exports.PI = PI;
module.exports.add = add;

// æˆ–è€…ä¸€æ¬¡æ€§å¯¼å‡º
module.exports = {
  PI,
  add,
  multiply,
};
```

```javascript
// calculator.js - å¯¼å…¥æ¨¡å—
const { add, multiply, PI } = require("./math");
// æˆ–è€…
const math = require("./math");

console.log(add(2, 3)); // 5
console.log(PI); // 3.14159
```

**CommonJS ç‰¹ç‚¹**

- **åŒæ­¥åŠ è½½**ï¼šrequire() æ˜¯åŒæ­¥æ“ä½œï¼Œé€‚åˆæœåŠ¡ç«¯ç¯å¢ƒ
- **åŠ¨æ€åŠ è½½**ï¼šå¯ä»¥åœ¨è¿è¡Œæ—¶å†³å®šåŠ è½½å“ªä¸ªæ¨¡å—
- **å•ä¾‹æ¨¡å¼**ï¼šæ¨¡å—åªä¼šè¢«åŠ è½½ä¸€æ¬¡ï¼Œä¹‹åéƒ½æ˜¯ç¼“å­˜
- **å€¼æ‹·è´**ï¼šå¯¼å‡ºçš„æ˜¯å€¼çš„æ‹·è´ï¼Œä¸æ˜¯å¼•ç”¨

```javascript
// counter.js
let count = 0;
module.exports = {
  increment() {
    count++;
  },
  getCount() {
    return count;
  },
};
```

```javascript
// main.js
const counter1 = require("./counter");
const counter2 = require("./counter");

counter1.increment();
console.log(counter2.getCount()); // 1 - åŒä¸€ä¸ªå®ä¾‹
```

### AMDï¼šå¼‚æ­¥æ¨¡å—å®šä¹‰

AMDï¼ˆAsynchronous Module Definitionï¼‰ä¸“ä¸ºæµè§ˆå™¨ç¯å¢ƒè®¾è®¡ï¼Œæ”¯æŒå¼‚æ­¥åŠ è½½æ¨¡å—ã€‚

**RequireJS å®ç°**

```javascript
// å®šä¹‰æ¨¡å—
define("math", [], function () {
  return {
    add: function (a, b) {
      return a + b;
    },
    multiply: function (a, b) {
      return a * b;
    },
  };
});

// ä½¿ç”¨ä¾èµ–
define("calculator", ["math"], function (math) {
  return {
    calculate: function (a, b, operation) {
      return math[operation](a, b);
    },
  };
});

// å…¥å£æ–‡ä»¶
require(["calculator"], function (calculator) {
  console.log(calculator.calculate(2, 3, "add")); // 5
});
```

**AMD é…ç½®**

```javascript
requirejs.config({
  baseUrl: "js/lib",
  paths: {
    jquery: "jquery-3.6.0.min",
    lodash: "lodash.min",
  },
  shim: {
    backbone: {
      deps: ["underscore", "jquery"],
      exports: "Backbone",
    },
  },
});
```

### UMDï¼šé€šç”¨æ¨¡å—å®šä¹‰

UMDï¼ˆUniversal Module Definitionï¼‰è¯•å›¾ç»Ÿä¸€ CommonJS å’Œ AMDï¼Œæä¾›è·¨ç¯å¢ƒçš„æ¨¡å—å®šä¹‰ã€‚

```javascript
(function (root, factory) {
  if (typeof define === "function" && define.amd) {
    // AMD ç¯å¢ƒ
    define(["jquery"], factory);
  } else if (typeof module === "object" && module.exports) {
    // CommonJS ç¯å¢ƒ
    module.exports = factory(require("jquery"));
  } else {
    // æµè§ˆå™¨å…¨å±€å˜é‡
    root.MyModule = factory(root.jQuery);
  }
})(typeof self !== "undefined" ? self : this, function ($) {
  return {
    init: function () {
      console.log("Module initialized");
    },
  };
});
```

---

## ES6 Modulesï¼šåŸç”Ÿæ¨¡å—ç³»ç»Ÿ

ES6ï¼ˆES2015ï¼‰å¼•å…¥äº†å®˜æ–¹çš„æ¨¡å—ç³»ç»Ÿï¼Œæˆä¸º JavaScript æ¨¡å—åŒ–çš„æ ‡å‡†ã€‚

### åŸºæœ¬è¯­æ³•

**å‘½åå¯¼å‡ºå’Œå¯¼å…¥**

```javascript
// utils.js
export const PI = 3.14159;
export const E = 2.71828;

export function add(a, b) {
  return a + b;
}

export function multiply(a, b) {
  return a * b;
}

// æ‰¹é‡å¯¼å‡º
const config = { version: "1.0.0" };
export { config };
```

```javascript
// main.js
import { PI, add, multiply } from "./utils.js";
import { config } from "./utils.js";

// é‡å‘½åå¯¼å…¥
import { PI as pi, add as sum } from "./utils.js";

// å…¨éƒ¨å¯¼å…¥
import * as utils from "./utils.js";
console.log(utils.PI, utils.add(2, 3));
```

**é»˜è®¤å¯¼å‡ºå’Œå¯¼å…¥**

```javascript
// logger.js
export default class Logger {
  constructor(name) {

this.name
 = name;
  }

  log(message) {
    console.log(`[${
this.name
}] ${message}`);
  }
}

// ä¹Ÿå¯ä»¥å¯¼å‡ºå‡½æ•°æˆ–å€¼
export default function createLogger(name) {
  return new Logger(name);
}
```

```javascript
// main.js
import Logger from "./logger.js";
import createLogger from "./logger.js"; // é»˜è®¤å¯¼å‡ºå¯ä»¥ä»»æ„å‘½å

const logger = new Logger("App");
logger.log("Hello World");
```

**æ··åˆå¯¼å‡º**

```javascript
// api.js
const BASE_URL = '
https://api.example.com
';

export { BASE_URL };

export function get(url) {
  return fetch(`${BASE_URL}${url}`);
}

export function post(url, data) {
  return fetch(`${BASE_URL}${url}`, {
    method: 'POST',
    body: JSON.stringify(data)
  });
}

// é»˜è®¤å¯¼å‡º
export default {
  get,
  post,
  BASE_URL
};
```

### ESM vs CommonJS

**å…³é”®å·®å¼‚å¯¹æ¯”**

| ç‰¹æ€§         | CommonJS | ES Modules           |
| ------------ | -------- | -------------------- |
| åŠ è½½æ—¶æœº     | è¿è¡Œæ—¶   | ç¼–è¯‘æ—¶               |
| åŠ è½½æ–¹å¼     | åŒæ­¥     | å¼‚æ­¥                 |
| è¾“å‡º         | å€¼æ‹·è´   | å€¼å¼•ç”¨               |
| åŠ¨æ€å¯¼å…¥     | æ”¯æŒ     | é€šè¿‡ `import()` æ”¯æŒ |
| å¾ªç¯ä¾èµ–     | éƒ¨åˆ†æ”¯æŒ | å®Œå…¨æ”¯æŒ             |
| Tree Shaking | ä¸æ”¯æŒ   | æ”¯æŒ                 |

**å€¼å¼•ç”¨ vs å€¼æ‹·è´**

```javascript
// ESM - å€¼å¼•ç”¨
// counter.js
export let count = 0;
export function increment() {
  count++;
}

// main.js
import { count, increment } from "./counter.js";
console.log(count); // 0
increment();
console.log(count); // 1 - å®æ—¶æ›´æ–°
```

```javascript
// CommonJS - å€¼æ‹·è´
// counter.js
let count = 0;
module.exports = {
  count,
  increment() {
    count++;
    this.count = count; // éœ€è¦æ‰‹åŠ¨æ›´æ–°å¯¼å‡ºå€¼
  },
};
```

### åŠ¨æ€å¯¼å…¥

ES2020 å¼•å…¥äº†åŠ¨æ€å¯¼å…¥ï¼Œæ”¯æŒæŒ‰éœ€åŠ è½½æ¨¡å—ã€‚

```javascript
// æ¡ä»¶å¯¼å…¥
async function loadModule(condition) {
  if (condition) {
    const { default: heavyModule } = await import("./heavy-module.js");
    return heavyModule;
  }
}

// é”™è¯¯å¤„ç†
try {
  const module = await import("./optional-module.js");
  module.init();
} catch (error) {
  console.log("Module not available:", error);
}

// åœ¨å‡½æ•°ä¸­ä½¿ç”¨
function lazyLoad() {
  import("./components/LazyComponent.js").then((module) => {
    const Component = module.default;
    // ä½¿ç”¨ç»„ä»¶
  });
}
```

**Webpack ä¸­çš„ä»£ç åˆ†å‰²**

```javascript
// è·¯ç”±çº§åˆ«çš„ä»£ç åˆ†å‰²
const routes = [
  {
    path: "/home",
    component: () => import("./views/Home.vue"),
  },
  {
    path: "/about",
    component: () => import("./views/About.vue"),
  },
];

// åŠŸèƒ½æ¨¡å—çš„æ‡’åŠ è½½
async function loadChart() {
  const { Chart } = await import("./lib/chart.js");
  return new Chart();
}
```

---

## åŒ…ç®¡ç†å·¥å…·æ·±åº¦è§£æ

### npmï¼šNode Package Manager

npm æ˜¯ Node.js çš„é»˜è®¤åŒ…ç®¡ç†å™¨ï¼Œä¹Ÿæ˜¯ä¸–ç•Œä¸Šæœ€å¤§çš„è½¯ä»¶åº“ã€‚

**åŸºæœ¬æ¦‚å¿µ**

```json
// package.json
{
  "name": "my-project",
  "version": "1.0.0",
  "description": "A sample project",
  "main": "index.js",
  "scripts": {
    "start": "node index.js",
    "dev": "nodemon index.js",
    "test": "jest",
    "build": "webpack --mode=production"
  },
  "dependencies": {
    "express": "^4.18.0",
    "lodash": "~4.17.21"
  },
  "devDependencies": {
    "webpack": "^5.70.0",
    "jest": "^28.0.0"
  },
  "peerDependencies": {
    "react": ">=16.8.0"
  },
  "engines": {
    "node": ">=14.0.0",
    "npm": ">=6.0.0"
  }
}
```

**è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶ (SemVer)**

```bash
# ç²¾ç¡®ç‰ˆæœ¬
"lodash": "4.17.21"

# è¡¥ä¸ç‰ˆæœ¬èŒƒå›´ (~)
"lodash": "~4.17.21"  # >=4.17.21 <4.18.0

# æ¬¡ç‰ˆæœ¬èŒƒå›´ (^)
"lodash": "^4.17.21"  # >=4.17.21 <5.0.0

# èŒƒå›´
"lodash": ">=4.17.0 <4.18.0"
"lodash": "4.17.x"
```

**npm å·¥ä½œæµç¨‹**

```bash
# åˆå§‹åŒ–é¡¹ç›®
npm init -y

# å®‰è£…ä¾èµ–
npm install express           # ç”Ÿäº§ä¾èµ–
npm install --save-dev jest   # å¼€å‘ä¾èµ–
npm install -g typescript     # å…¨å±€å®‰è£…

# ç‰ˆæœ¬ç®¡ç†
npm version patch  # 1.0.0 -> 1.0.1
npm version minor  # 1.0.1 -> 1.1.0
npm version major  # 1.1.0 -> 2.0.0

# å‘å¸ƒåŒ…
npm login
npm publish
npm unpublish package-name@version
```

**npm scripts é«˜çº§ç”¨æ³•**

```json
{
  "scripts": {
    "prestart": "echo 'Preparing to start'",
    "start": "node server.js",
    "poststart": "echo 'Server started'",

    "prebuild": "rimraf dist",
    "build": "webpack --mode=production",
    "postbuild": "echo 'Build completed'",

    "dev": "concurrently \"npm run server\" \"npm run client\"",
    "server": "nodemon server.js",
    "client": "webpack serve --mode=development",

    "lint": "eslint src/**/*.js",
    "lint:fix": "eslint src/**/*.js --fix",
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage"
  }
}
```

### Yarnï¼šå¿«é€Ÿã€å¯é ã€å®‰å…¨çš„ä¾èµ–ç®¡ç†

Yarn ç”± Facebook å¼€å‘ï¼Œæ—¨åœ¨è§£å†³ npm çš„ä¸€äº›é—®é¢˜ã€‚

**Yarn ç‰¹æ€§**

```bash
# åˆå§‹åŒ–
yarn init

# å®‰è£…ä¾èµ–
yarn add package-name
yarn add package-name --dev
yarn add package-name --peer

# å®‰è£…æ‰€æœ‰ä¾èµ–
yarn install

# å‡çº§ä¾èµ–
yarn upgrade package-name
yarn upgrade-interactive

# ç§»é™¤ä¾èµ–
yarn remove package-name
```

**yarn.lock çš„é‡è¦æ€§**

```yaml
# yarn.lock
"@babel/core@^7.12.3":
  version "7.17.8"
  resolved "
https://registry.yarnpkg.com/@babel/core/-/core-7.17.8.tgz
"
  integrity sha512-OdQDV/7cRBtJHLSOBqqbYNkOcydOgnX59TZx4puf41fzcVtN3e/4yqY8lMQsK+5X2lJtAdmA+6OHqsj1hBJ4IQ==
  dependencies:
    "@ampproject/remapping" "^2.1.0"
    "@babel/code-frame" "^7.16.7"
```

**Workspaces æ”¯æŒ**

```json
// package.json
{
  "name": "my-monorepo",
  "private": true,
  "workspaces": ["packages/*"]
}
```

```bash
# é¡¹ç›®ç»“æ„
my-monorepo/
â”œâ”€â”€ package.json
â””â”€â”€ packages/
    â”œâ”€â”€ package-a/
    â”‚   â””â”€â”€ package.json
    â””â”€â”€ package-b/
        â””â”€â”€ package.json

# workspace å‘½ä»¤
yarn workspace package-a add lodash
yarn workspaces run test
```

### pnpmï¼šé«˜æ•ˆçš„ç£ç›˜ç©ºé—´åˆ©ç”¨

pnpm é€šè¿‡ç¡¬é“¾æ¥å’Œç¬¦å·é“¾æ¥å®ç°é«˜æ•ˆçš„åŒ…ç®¡ç†ã€‚

**pnpm çš„å­˜å‚¨æœºåˆ¶**

```bash
# å…¨å±€å­˜å‚¨
~/.pnpm-store/
â”œâ”€â”€ v3/
â”‚   â””â”€â”€ files/
â”‚       â”œâ”€â”€ 00/
â”‚       â”‚   â””â”€â”€ 1a2b3c4d5e6f...
â”‚       â””â”€â”€ 01/
â”‚           â””â”€â”€ 2b3c4d5e6f7a...

# é¡¹ç›® node_modules
node_modules/
â”œâ”€â”€ .pnpm/
â”‚   â”œâ”€â”€ lodash@4.17.21/
â”‚   â”‚   â””â”€â”€ node_modules/
â”‚   â”‚       â””â”€â”€ lodash/ -> ~/.pnpm-store/v3/files/...
â”‚   â””â”€â”€ express@4.18.0/
â””â”€â”€ lodash -> .pnpm/lodash@4.17.21/node_modules/lodash
```

**pnpm å‘½ä»¤**

```bash
# å®‰è£…
pnpm install
pnpm add package-name
pnpm add -D package-name

# ç§»é™¤
pnpm remove package-name

# æ›´æ–°
pnpm update
pnpm update package-name

# æ‰§è¡Œè„šæœ¬
pnpm run build
pnpm start

# workspace
pnpm -r run build          # åœ¨æ‰€æœ‰ workspace ä¸­è¿è¡Œ
pnpm --filter package-a run test
```

**æ€§èƒ½å¯¹æ¯”**

| æ“ä½œ              | npm | yarn | pnpm |
| ----------------- | --- | ---- | ---- |
| å®‰è£…æ—¶é—´          | æ…¢  | å¿«   | æœ€å¿« |
| ç£ç›˜ä½¿ç”¨          | é«˜  | é«˜   | ä½   |
| node_modules å¤§å° | å¤§  | å¤§   | å°   |
| å¹½çµä¾èµ–          | æœ‰  | æœ‰   | æ—    |

### ä¸‰å¤§åŒ…ç®¡ç†å™¨æ·±åº¦å¯¹æ¯”

åœ¨é€‰æ‹©åŒ…ç®¡ç†å™¨æ—¶ï¼Œäº†è§£å®ƒä»¬çš„å·®å¼‚å’Œé€‚ç”¨åœºæ™¯è‡³å…³é‡è¦ã€‚è®©æˆ‘ä»¬ä»å¤šä¸ªç»´åº¦æ·±å…¥åˆ†æ npmã€yarn å’Œ pnpmã€‚

### æ¶æ„è®¾è®¡å¯¹æ¯”

**npm çš„æ‰å¹³åŒ–ç»“æ„**

```bash
# npm v3+ é‡‡ç”¨æ‰å¹³åŒ–å®‰è£…
node_modules/
â”œâ”€â”€ react/
â”œâ”€â”€ lodash/
â”œâ”€â”€ express/
â”‚   â””â”€â”€ node_modules/
â”‚       â””â”€â”€ accepts/  # express çš„ç‰¹å®šç‰ˆæœ¬ä¾èµ–
â””â”€â”€ accepts/          # æå‡åˆ°é¡¶å±‚çš„å…¬å…±ä¾èµ–
```

**yarn çš„æ”¹è¿›æ‰å¹³åŒ–**

```bash
# yarn ä¼˜åŒ–äº† npm çš„æ‰å¹³åŒ–ç®—æ³•
node_modules/
â”œâ”€â”€ .yarn-integrity    # å®Œæ•´æ€§æ£€æŸ¥æ–‡ä»¶
â”œâ”€â”€ react/
â”œâ”€â”€ lodash/
â””â”€â”€ express/
    â””â”€â”€ node_modules/
        â””â”€â”€ mime/     # ç‰ˆæœ¬å†²çªæ—¶çš„åµŒå¥—ä¾èµ–
```

**pnpm çš„ç¬¦å·é“¾æ¥ç»“æ„**

```bash
# pnpm ä½¿ç”¨ç¬¦å·é“¾æ¥é¿å…é‡å¤
node_modules/
â”œâ”€â”€ .pnpm/
â”‚   â”œâ”€â”€ react@18.2.0/
â”‚   â”‚   â””â”€â”€ node_modules/
â”‚   â”‚       â”œâ”€â”€ react/        # å®é™…æ–‡ä»¶
â”‚   â”‚       â””â”€â”€ loose-envify/ # ç¡¬é“¾æ¥åˆ°å…¨å±€ store
â”‚   â””â”€â”€ lodash@4.17.21/
â”‚       â””â”€â”€ node_modules/
â”‚           â””â”€â”€ lodash/       # ç¡¬é“¾æ¥åˆ°å…¨å±€ store
â”œâ”€â”€ react -> .pnpm/react@18.2.0/node_modules/react
â””â”€â”€ lodash -> .pnpm/lodash@4.17.21/node_modules/lodash
```

### å®‰è£…é€Ÿåº¦å¯¹æ¯”æµ‹è¯•

**çœŸå®é¡¹ç›®æµ‹è¯•ç»“æœ**

```bash
# æµ‹è¯•ç¯å¢ƒï¼šMacBook Pro M1, SSD, 100Mbps ç½‘ç»œ
# é¡¹ç›®ï¼šReact åº”ç”¨ï¼Œçº¦ 150 ä¸ªä¾èµ–åŒ…

# é¦–æ¬¡å®‰è£…ï¼ˆæ— ç¼“å­˜ï¼‰
npm install     # 45.2s
yarn install    # 37.8s
pnpm install    # 28.3s

# æœ‰ç¼“å­˜ä½†åˆ é™¤ node_modules åé‡è£…
npm install     # 23.1s
yarn install    # 18.7s
pnpm install    # 12.4s

# å¢åŠ å•ä¸ªä¾èµ–åŒ…
npm install lodash     # 8.7s
yarn add lodash        # 5.2s
pnpm add lodash        # 3.1s
```

**é€Ÿåº¦å·®å¼‚åŸå› åˆ†æ**

```javascript
// npm çš„ä¸²è¡Œå®‰è£…è¿‡ç¨‹
async function npmInstall() {
  const packages = await resolvePackages();
  for (const pkg of packages) {
    await downloadPackage(pkg); // ä¸²è¡Œä¸‹è½½
    await extractPackage(pkg); // ä¸²è¡Œè§£å‹
  }
  await linkPackages();
}

// yarn çš„å¹¶è¡Œä¼˜åŒ–
async function yarnInstall() {
  const packages = await resolvePackages();
  await Promise.all(packages.map(downloadPackage)); // å¹¶è¡Œä¸‹è½½
  await Promise.all(packages.map(extractPackage)); // å¹¶è¡Œè§£å‹
  await linkPackages();
}

// pnpm çš„ç¡¬é“¾æ¥ä¼˜åŒ–
async function pnpmInstall() {
  const packages = await resolvePackages();
  await Promise.all(
    packages.map(async (pkg) => {
      const cached = await checkGlobalStore(pkg);
      if (cached) {
        await createHardLink(cached, pkg); // ç¬é—´å®Œæˆ
      } else {
        await downloadAndStore(pkg); // ä¸‹è½½åˆ°å…¨å±€ store
        await createHardLink(pkg); // åˆ›å»ºç¡¬é“¾æ¥
      }
    }),
  );
}
```

### ç£ç›˜ä½¿ç”¨æ•ˆç‡å¯¹æ¯”

**å­˜å‚¨ç©ºé—´æµ‹è¯•**

```bash
# æµ‹è¯•åœºæ™¯ï¼š3 ä¸ªé¡¹ç›®ä½¿ç”¨ç›¸åŒçš„ React ç”Ÿæ€ä¾èµ–

# npm æ–¹æ¡ˆ
project-a/node_modules/    # 234MB
project-b/node_modules/    # 234MB
project-c/node_modules/    # 234MB
æ€»è®¡: 702MB

# yarn æ–¹æ¡ˆ
project-a/node_modules/    # 231MB
project-b/node_modules/    # 231MB
project-c/node_modules/    # 231MB
æ€»è®¡: 693MB

# pnpm æ–¹æ¡ˆ
~/.pnpm-store/             # 245MB (å…¨å±€ store)
project-a/node_modules/    # 15MB  (ç¬¦å·é“¾æ¥)
project-b/node_modules/    # 15MB
project-c/node_modules/    # 15MB
æ€»è®¡: 290MB
èŠ‚çœç©ºé—´: 59%
```

**pnpm å­˜å‚¨åŸç†è¯¦è§£**

```bash
# å…¨å±€ store ç»“æ„
~/.pnpm-store/
â””â”€â”€ v3/
    â””â”€â”€ files/
        â”œâ”€â”€ 00/
        â”‚   â””â”€â”€ 1a2b3c...
        â”œâ”€â”€ 01/
        â”‚   â””â”€â”€ 2b3c4d...
        â””â”€â”€ ff/
            â””â”€â”€ fe9d8c...

# é¡¹ç›®ä¸­çš„ç¡¬é“¾æ¥
node_modules/.pnpm/react@18.2.0/node_modules/react/index.js
# â†“ ç¡¬é“¾æ¥æŒ‡å‘
~/.pnpm-store/v3/files/a1/b2c3d4e5f6...

# æ£€æŸ¥ç¡¬é“¾æ¥
ls -la node_modules/react/
# è¾“å‡ºæ˜¾ç¤ºç›¸åŒçš„ inode å·ï¼Œè¯æ˜æ˜¯ç¡¬é“¾æ¥
```

### ä¾èµ–è§£æç­–ç•¥å¯¹æ¯”

**npm çš„è§£æç®—æ³•**

```javascript
// npm çš„ node_modules è§£æ
function resolveNpm(packageName, from) {
  let current = from;
  while (current !== "/") {
    const modulePath = path.join(current, "node_modules", packageName);
    if (fs.existsSync(modulePath)) {
      return modulePath;
    }
    current = path.dirname(current); // å‘ä¸ŠæŸ¥æ‰¾
  }
  throw new Error(`Cannot find module '${packageName}'`);
}
```

**pnpm çš„ä¸¥æ ¼è§£æ**

```javascript
// pnpm åªèƒ½è®¿é—®æ˜¾å¼å£°æ˜çš„ä¾èµ–
// package.json
{
  "dependencies": {
    "express": "^4.18.0"
    // æ²¡æœ‰å£°æ˜ lodash
  }
}

// åœ¨ä»£ç ä¸­
const express = require('express');  // âœ… å¯ä»¥è®¿é—®
const lodash = require('lodash');    // âŒ æ— æ³•è®¿é—®ï¼Œå³ä½¿ express ä¾èµ–å®ƒ
```

### å¹½çµä¾èµ–é—®é¢˜è¯¦è§£

**ä»€ä¹ˆæ˜¯å¹½çµä¾èµ–**

```javascript
// package.json ä¸­æ²¡æœ‰å£°æ˜ lodash
{
  "dependencies": {
    "some-package": "^1.0.0"  // some-package å†…éƒ¨ä¾èµ– lodash
  }
}

// ä½†åœ¨ä»£ç ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼ˆnpm å’Œ yarnï¼‰
const _ = require('lodash');  // æ„å¤–å¯ç”¨ï¼Œä½†ä¸ç¨³å®š
```

**å„å·¥å…·å¯¹å¹½çµä¾èµ–çš„å¤„ç†**

| åŒ…ç®¡ç†å™¨ | å¹½çµä¾èµ– | è§£å†³æ–¹æ¡ˆ                      |
| -------- | -------- | ----------------------------- |
| npm      | å­˜åœ¨     | æ‰‹åŠ¨æ£€æŸ¥ï¼Œä½¿ç”¨ `npm ls`       |
| yarn     | å­˜åœ¨     | `yarn why` æ£€æŸ¥ï¼ŒPnP æ¨¡å¼é¿å… |
| pnpm     | ä¸å­˜åœ¨   | ä¸¥æ ¼çš„ä¾èµ–éš”ç¦»                |

**pnpm å¦‚ä½•é˜²æ­¢å¹½çµä¾èµ–**

```bash
# pnpm çš„ node_modules ç»“æ„
node_modules/
â”œâ”€â”€ .pnpm/                    # çœŸå®çš„åŒ…æ–‡ä»¶
â”‚   â””â”€â”€ express@4.18.0/
â”‚       â””â”€â”€ node_modules/
â”‚           â”œâ”€â”€ express/      # express æœ¬èº«
â”‚           â””â”€â”€ lodash/       # express çš„ä¾èµ–
â””â”€â”€ express -> .pnpm/express@4.18.0/node_modules/express
# lodash æ²¡æœ‰ç¬¦å·é“¾æ¥åˆ°é¡¶å±‚ï¼Œæ— æ³•ç›´æ¥è®¿é—®
```

### Monorepo æ”¯æŒå¯¹æ¯”

**npm workspacesï¼ˆnpm 7+ï¼‰**

```json
{
  "name": "my-monorepo",
  "workspaces": ["packages/*"],
  "scripts": {
    "build:all": "npm run build --workspaces",
    "test:all": "npm run test --workspaces --if-present"
  }
}
```

```bash
# npm workspace å‘½ä»¤
npm install --workspace=package-a
npm run build --workspace=package-a
npm run test --workspaces
```

**yarn workspaces**

```json
{
  "workspaces": {
    "packages": ["packages/*"],
    "nohoist": ["**/babel-preset-react-native"]
  }
}
```

```bash
# yarn workspace å‘½ä»¤
yarn workspace package-a add lodash
yarn workspaces run build
yarn workspaces foreach run test
```

**pnpm workspace**

```yaml
# pnpm-workspace.yaml
packages:
  - "packages/*"
  - "apps/*"
  - "!!**/test/**"
```

```bash
# pnpm workspace å‘½ä»¤
pnpm add lodash --filter package-a
pnpm run build --filter package-a
pnpm -r run test              # recursive
pnpm --filter "./packages/**" run build
```

### å®‰å…¨æ€§å¯¹æ¯”

**npm å®‰å…¨ç‰¹æ€§**

```bash
# npm å®¡è®¡
npm audit                    # æ£€æŸ¥å®‰å…¨æ¼æ´
npm audit fix                # è‡ªåŠ¨ä¿®å¤
npm audit fix --force        # å¼ºåˆ¶ä¿®å¤ï¼ˆå¯èƒ½ç ´åå…¼å®¹æ€§ï¼‰

# npm publish å®‰å…¨
npm publish --otp=123456     # åŒå› ç´ è®¤è¯
npm access public package-name  # è®¾ç½®åŒ…è®¿é—®æƒé™
```

**yarn å®‰å…¨æ”¹è¿›**

```bash
# yarn å®¡è®¡
yarn audit                        # æ£€æŸ¥æ¼æ´
yarn audit --groups dependencies  # åªæ£€æŸ¥ç”Ÿäº§ä¾èµ–

# yarn å®Œæ•´æ€§æ£€æŸ¥
yarn install --check-files        # éªŒè¯æ–‡ä»¶å®Œæ•´æ€§
yarn install --frozen-lockfile    # ä¸¥æ ¼æŒ‰ç…§ lockfile å®‰è£…
```

**pnpm å®‰å…¨ä¼˜åŠ¿**

```bash
# pnpm å¤©ç„¶çš„å®‰å…¨éš”ç¦»
pnpm install                 # ä¸¥æ ¼çš„ä¾èµ–éš”ç¦»é˜²æ­¢æ„å¤–è®¿é—®
pnpm audit                   # å®‰å…¨å®¡è®¡
pnpm why package-name        # åˆ†æä¾èµ–å…³ç³»

# å†…å®¹å¯»å€å­˜å‚¨ä¿è¯å®Œæ•´æ€§
# æ–‡ä»¶å†…å®¹æ”¹å˜ä¼šå¯¼è‡´ hash æ”¹å˜ï¼Œè‡ªåŠ¨æ£€æµ‹ç¯¡æ”¹
```

### é…ç½®æ–‡ä»¶å¯¹æ¯”

**npm é…ç½®ï¼ˆ.npmrcï¼‰**

```plain text
registry=
https://registry.npmjs.org/<br>save-exact=true<br>engine-strict=true<br>fund=false<br>audit-level=moderate<br><br>#

@company:registry=
https://npm.company.com/<br>//npm.company.com/:_authToken=token123<br>
```

**yarn é…ç½®ï¼ˆ.yarnrc.ymlï¼‰**

```yaml
nodeLinker: node-modules
yarnPath: .yarn/releases/yarn-3.6.1.cjs

packageExtensions:
  "webpack@*":
    peerDependencies:
      webpack-cli: "*"

plugins:
  - path: .yarn/plugins/@yarnpkg/plugin-workspace-tools.cjs
    spec: "@yarnpkg/plugin-workspace-tools"
```

**pnpm é…ç½®ï¼ˆ.pnpmrcï¼‰**

```plain text
store-dir=/path/to/pnpm-store
shared-workspace-lockfile=true
link-workspace-packages=deep
hoist=true
shamefully-hoist=false

# ä¸¥æ ¼çš„ peer ä¾èµ–æ£€æŸ¥
strict-peer-dependencies=true
auto-install-peers=false
```

### è¿ç§»æŒ‡å—

**ä» npm è¿ç§»åˆ° yarn**

```bash
# 1. åˆ é™¤ npm ç›¸å…³æ–‡ä»¶
rm package-lock.json
rm -rf node_modules

# 2. å®‰è£… yarn
npm install -g yarn

# 3. å®‰è£…ä¾èµ–
yarn install

# 4. æ›´æ–° CI/CD è„šæœ¬
# å°† npm ci æ”¹ä¸º yarn install --frozen-lockfile
# å°† npm run build æ”¹ä¸º yarn build
```

**ä» npm / yarn è¿ç§»åˆ° pnpm**

```bash
# 1. å®‰è£… pnpm
npm install -g pnpm

# 2. åˆ é™¤æ—§æ–‡ä»¶
rm package-lock.json yarn.lock
rm -rf node_modules

# 3. åˆ›å»º .pnpmrc é…ç½®
echo "shamefully-hoist=true" > .pnpmrc  # å…¼å®¹æ€§è®¾ç½®

# 4. å®‰è£…ä¾èµ–
pnpm install

# 5. æ›´æ–°è„šæœ¬å‘½ä»¤
# package.json ä¸­çš„ npm run -> pnpm run
```

### æ€§èƒ½è°ƒä¼˜å»ºè®®

**npm ä¼˜åŒ–**

```json
// package.json
{
  "scripts": {
    "postinstall": "npm prune" // æ¸…ç†æ— ç”¨åŒ…
  }
}
```

```bash
# .npmrc ä¼˜åŒ–é…ç½®
cache-max=86400000           # å¢å¤§ç¼“å­˜æ—¶é—´
prefer-offline=true          # ä¼˜å…ˆä½¿ç”¨ç¼“å­˜
progress=false               # å…³é—­è¿›åº¦æ¡æå‡ CI é€Ÿåº¦
audit=false                  # CI ä¸­è·³è¿‡ audit
fund=false                   # å…³é—­ funding æ¶ˆæ¯
```

**yarn ä¼˜åŒ–**

```yaml
# .yarnrc.yml
compressionLevel: mixed
enableGlobalCache: true
enableInlineBuilds: true
enableNetwork: true

# ç½‘ç»œé…ç½®
httpTimeout: 60000
networkTimeout: 60000
```

**pnpm ä¼˜åŒ–**

```plain text
# .pnpmrc
fetch-retries=3
fetch-retry-factor=2
fetch-retry-mintimeout=10000
fetch-retry-maxtimeout=60000

# å­˜å‚¨ä¼˜åŒ–
verify-store-integrity=false  # è·³è¿‡ store å®Œæ•´æ€§æ£€æŸ¥ï¼ˆCI ç¯å¢ƒï¼‰
child-concurrency=5           # å¹¶å‘å­è¿›ç¨‹æ•°
```

### é€‰æ‹©å»ºè®®

**é€‰æ‹© npm çš„åœºæ™¯**

- æ–°æ‰‹å…¥é—¨é¡¹ç›®
- éœ€è¦æœ€å¤§å…¼å®¹æ€§
- ç®€å•çš„å•ä»“åº“é¡¹ç›®
- å›¢é˜Ÿå·²ç†Ÿæ‚‰ npm ç”Ÿæ€

**é€‰æ‹© yarn çš„åœºæ™¯**

- éœ€è¦ç¨³å®šçš„ lockfile
- å¤æ‚çš„ monorepo é¡¹ç›®
- ä½¿ç”¨ yarn ç‰¹æœ‰çš„åŠŸèƒ½ï¼ˆå¦‚ PnPï¼‰
- æ³¨é‡å®‰è£…é€Ÿåº¦

**é€‰æ‹© pnpm çš„åœºæ™¯**

- ç£ç›˜ç©ºé—´å—é™
- ä¸¥æ ¼çš„ä¾èµ–ç®¡ç†éœ€æ±‚
- å¤§å‹ monorepo é¡¹ç›®
- æ³¨é‡å®‰è£…å’Œè¿è¡Œé€Ÿåº¦
- å¤šé¡¹ç›®å¼€å‘ç¯å¢ƒ

---

## ç°ä»£æ‰“åŒ…å·¥å…·

### Webpackï¼šå¼ºå¤§çš„æ¨¡å—æ‰“åŒ…å™¨

Webpack æ˜¯ç›®å‰æœ€æµè¡Œçš„å‰ç«¯æ‰“åŒ…å·¥å…·ï¼Œæ”¯æŒå„ç§æ¨¡å—ç³»ç»Ÿã€‚

**åŸºæœ¬é…ç½®**

```javascript
// webpack.config.js
const path = require("path");

module.exports = {
  entry: "./src/index.js",
  output: {
    filename: "bundle.[contenthash].js",
    path: path.resolve(__dirname, "dist"),
    clean: true,
  },
  module: {
    rules: [
      {
        test: /\.js$/,
        exclude: /node_modules/,
        use: {
          loader: "babel-loader",
          options: {
            presets: ["@babel/preset-env"],
          },
        },
      },
      {
        test: /\.css$/,
        use: ["style-loader", "css-loader"],
      },
      {
        test: /\.(png|jpg|gif)$/,
        type: "asset/resource",
      },
    ],
  },
  plugins: [
    new HtmlWebpackPlugin({
      template: "./src/index.html",
    }),
  ],
  optimization: {
    splitChunks: {
      chunks: "all",
      cacheGroups: {
        vendor: {
          test: /[\\/]node_modules[\\/]/,
          name: "vendors",
          chunks: "all",
        },
      },
    },
  },
};
```

**ä»£ç åˆ†å‰²ç­–ç•¥**

```javascript
// å…¥å£ç‚¹åˆ†å‰²
module.exports = {
  entry: {
    app: './src/app.js',
    admin: './src/admin.js'
  }
};

// åŠ¨æ€å¯¼å…¥
const LazyComponent = React.lazy(() => import('./LazyComponent'));

// SplitChunksPlugin é…ç½®
optimization: {
  splitChunks: {
    chunks: 'all',
    minSize: 20000,
    maxSize: 244000,
    cacheGroups: {
      default: {
        minChunks: 2,
        priority: -20,
        reuseExistingChunk: true
      },
      vendor: {
        test: /[\\/]node_modules[\\/]/,
        priority: -10,
        reuseExistingChunk: true
      }
    }
  }
};
```

### Rollupï¼šä¸“æ³¨äº ES æ¨¡å—çš„æ‰“åŒ…å™¨

Rollup ä¸“ä¸º ES æ¨¡å—è®¾è®¡ï¼Œæ”¯æŒæ›´å¥½çš„ Tree Shakingã€‚

```javascript
// rollup.config.js
import resolve from "@rollup/plugin-node-resolve";
import commonjs from "@rollup/plugin-commonjs";
import { terser } from "rollup-plugin-terser";

export default {
  input: "src/main.js",
  output: [
    {
      file: "dist/bundle.cjs.js",
      format: "cjs",
    },
    {
      file: "dist/bundle.esm.js",
      format: "es",
    },
    {
      file: "dist/bundle.umd.js",
      format: "umd",
      name: "MyLibrary",
    },
  ],
  plugins: [resolve(), commonjs(), terser()],
  external: ["lodash"], // å¤–éƒ¨ä¾èµ–
};
```

### Viteï¼šåŸºäº ESM çš„ç°ä»£æ„å»ºå·¥å…·

Vite åˆ©ç”¨æµè§ˆå™¨åŸç”Ÿ ESM æ”¯æŒï¼Œæä¾›å¿«é€Ÿçš„å¼€å‘ä½“éªŒã€‚

```javascript
// vite.config.js
import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';

export default defineConfig({
  plugins: [vue()],
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['vue', 'vue-router'],
          utils: ['lodash', 'axios']
        }
      }
    }
  },
  server: {
    proxy: {
      '/api': '
http://localhost:3000
'
    }
  }
});
```

**Vite çš„å·¥ä½œåŸç†**

```javascript
// å¼€å‘æ¨¡å¼ä¸‹çš„æ¨¡å—è§£æ
import { createApp } from "vue";
import App from "./App.vue";

// Vite ä¼šå°†è¿™äº›è½¬æ¢ä¸ºï¼š
import { createApp } from "/@modules/vue";
import App from "/src/App.vue";
```

---

## Tree Shaking åŸç†ä¸å®è·µ

Tree Shaking æ˜¯æ¶ˆé™¤æ— ç”¨ä»£ç çš„é‡è¦æŠ€æœ¯ã€‚

### ES æ¨¡å—çš„é™æ€ç‰¹æ€§

```javascript
// utils.js
export function add(a, b) {
  return a + b;
}

export function multiply(a, b) {
  return a * b;
}

export function subtract(a, b) {
  return a - b; // è¿™ä¸ªå‡½æ•°æœªè¢«ä½¿ç”¨
}
```

```javascript
// main.js
import { add, multiply } from "./utils.js";

console.log(add(2, 3));
// subtract å‡½æ•°ä¼šè¢« Tree Shaking ç§»é™¤
```

### å‰¯ä½œç”¨æ ‡è®°

```json
// package.json
{
  "name": "my-package",
  "sideEffects": false  // æ ‡è®°ä¸ºæ— å‰¯ä½œç”¨
}

// æˆ–è€…æŒ‡å®šæœ‰å‰¯ä½œç”¨çš„æ–‡ä»¶
{
  "sideEffects": [
    "*.css",
    "./src/polyfills.js"
  ]
}
```

### ä¼˜åŒ–æŠ€å·§

```javascript
// é¿å…å¯¼å…¥æ•´ä¸ªåº“
import _ from "lodash"; // å¯¼å…¥æ•´ä¸ª lodash

// ä½¿ç”¨å…·ä½“å¯¼å…¥
import debounce from "lodash/debounce";
import throttle from "lodash/throttle";

// æˆ–ä½¿ç”¨ babel-plugin-lodash
import { debounce, throttle } from "lodash";
// è‡ªåŠ¨è½¬æ¢ä¸ºä¸Šé¢çš„å½¢å¼
```

---

## æ¨¡å—è”é‚¦ï¼ˆModule Federationï¼‰

Webpack 5 å¼•å…¥çš„æ¨¡å—è”é‚¦å…è®¸å¤šä¸ªç‹¬ç«‹åº”ç”¨å…±äº«æ¨¡å—ã€‚

### åŸºæœ¬é…ç½®

```javascript
// host åº”ç”¨é…ç½®
const ModuleFederationPlugin = require('@module-federation/webpack');

module.exports = {
  plugins: [
    new ModuleFederationPlugin({
      name: 'host',
      remotes: {
        remoteApp: 'remoteApp@
http://localhost:3001/remoteEntry.js'<br>
'
      }
    })
  ]
};

// remote åº”ç”¨é…ç½®
module.exports = {
  plugins: [
    new ModuleFederationPlugin({
      name: 'remoteApp',
      filename: 'remoteEntry.js',
      exposes: {
        './Button': './src/components/Button'
      }
    })
  ]
};
```

### åŠ¨æ€ä½¿ç”¨è¿œç¨‹æ¨¡å—

```javascript
// åœ¨ host åº”ç”¨ä¸­ä½¿ç”¨
const RemoteButton = React.lazy(() => import("remoteApp/Button"));

function App() {
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <RemoteButton />
    </Suspense>
  );
}
```

---

## æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### ä¾èµ–åˆ†æå’Œä¼˜åŒ–

```bash
# åˆ†æåŒ…å¤§å°
npm install -g webpack-bundle-analyzer
webpack-bundle-analyzer dist/static/js/*.js

# æ£€æŸ¥é‡å¤ä¾èµ–
npx npm-check-duplicates

# åˆ†æä¾èµ–å…³ç³»
npm ls --depth=0
npm audit
```

### ç¼“å­˜ç­–ç•¥

```javascript
// webpack ç¼“å­˜é…ç½®
module.exports = {
  cache: {
    type: "filesystem",
    buildDependencies: {
      config: [__filename],
    },
  },
  optimization: {
    moduleIds: "deterministic",
    runtimeChunk: "single",
    splitChunks: {
      cacheGroups: {
        vendor: {
          test: /[\\/]node_modules[\\/]/,
          name: "vendors",
          chunks: "all",
        },
      },
    },
  },
};
```

### é¢„åŠ è½½å’Œé¢„å–

```javascript
// é¢„åŠ è½½å…³é”®èµ„æº
import(/* webpackPreload: true */ "./critical-module");

// é¢„å–æœªæ¥å¯èƒ½éœ€è¦çš„èµ„æº
import(/* webpackPrefetch: true */ "./optional-module");

// åŠ¨æ€å¯¼å…¥æ—¶çš„é”™è¯¯å¤„ç†
async function loadModule() {
  try {
    const module = await import("./async-module");
    return module.default;
  } catch (error) {
    console.error("Failed to load module:", error);
    // é™çº§æ–¹æ¡ˆ
    return null;
  }
}
```

---

## æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹

### åŒ…ç®¡ç†æœ€ä½³å®è·µ

**1. é”å®šæ–‡ä»¶çš„é‡è¦æ€§**

```bash
# ç¡®ä¿åœ¨ CI/CD ä¸­ä½¿ç”¨é”å®šæ–‡ä»¶
npm ci  # è€Œä¸æ˜¯ npm install
yarn install --frozen-lockfile
pnpm install --frozen-lockfile
```

**2. å®‰å…¨æ€§æ£€æŸ¥**

```bash
# å®šæœŸæ£€æŸ¥å®‰å…¨æ¼æ´
npm audit
npm audit fix

# ä½¿ç”¨å®‰å…¨æ‰«æå·¥å…·
npx audit-ci --moderate
```

**3. ç‰ˆæœ¬ç®¡ç†ç­–ç•¥**

```json
{
  "engines": {
    "node": ">=14.0.0",
    "npm": ">=6.0.0"
  },
  "volta": {
    "node": "16.14.0",
    "npm": "8.3.1"
  }
}
```

### æ¨¡å—è®¾è®¡åŸåˆ™

**1. å•ä¸€èŒè´£åŸåˆ™**

```javascript
// å¥½çš„æ¨¡å—è®¾è®¡
// auth.js - åªå¤„ç†è®¤è¯
export function login(credentials) {
  /* ... */
}
export function logout() {
  /* ... */
}
export function isAuthenticated() {
  /* ... */
}

// é¿å…æ··åˆåŠŸèƒ½
// utils.js - åŠŸèƒ½å¤ªæ‚ä¹±
export function formatDate() {
  /* ... */
}
export function login() {
  /* ... */
} // åº”è¯¥åˆ†ç¦»åˆ° auth æ¨¡å—
export function validateForm() {
  /* ... */
} // åº”è¯¥åˆ†ç¦»åˆ° validation æ¨¡å—
```

**2. æ˜ç¡®çš„ API æ¥å£**

```javascript
// æ¸…æ™°çš„å¯¼å‡ºæ¥å£
// api/index.js
export { default as userAPI } from './user';
export { default as orderAPI } from './order';
export { default as productAPI } from './product';

// ç±»å‹å®šä¹‰
export type { User, Order, Product } from './types';
```

**3. é¿å…å¾ªç¯ä¾èµ–**

```javascript
// é—®é¢˜ï¼šå¾ªç¯ä¾èµ–
// moduleA.js
import { functionB } from "./moduleB";
export function functionA() {
  return functionB();
}

// moduleB.js
import { functionA } from "./moduleA"; // å¾ªç¯ä¾èµ–
export function functionB() {
  return functionA();
}

// è§£å†³æ–¹æ¡ˆï¼šæŠ½å–å…¬å…±ä¾èµ–
// shared.js
export function sharedFunction() {
  /* ... */
}

// moduleA.js
import { sharedFunction } from "./shared";
export function functionA() {
  return sharedFunction();
}

// moduleB.js
import { sharedFunction } from "./shared";
export function functionB() {
  return sharedFunction();
}
```

### æ„å»ºä¼˜åŒ–å»ºè®®

**1. åˆç†çš„ä»£ç åˆ†å‰²**

```javascript
// è·¯ç”±çº§åˆ†å‰²
const routes = [
  {
    path: "/dashboard",
    component: () => import("./views/Dashboard.vue"),
  },
];

// åŠŸèƒ½çº§åˆ†å‰²
async function loadEditor() {
  const { Editor } = await import("./components/Editor");
  return Editor;
}
```

**2. å¤–éƒ¨åŒ–å¤§å‹ä¾èµ–**

```javascript
// webpack.config.js
module.exports = {
  externals: {
    react: "React",
    "react-dom": "ReactDOM",
    lodash: "_",
  },
};
```

---

## æœªæ¥å±•æœ›

### ES æ¨¡å—çš„æ¼”è¿›

éšç€æµè§ˆå™¨å¯¹ ES æ¨¡å—æ”¯æŒçš„å®Œå–„ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†æ–°çš„å‘å±•è¶‹åŠ¿ï¼š

**1. Import Maps**

```html
<script type="importmap">
  {
    "imports": {
      "lodash": "
  https://cdn.skypack.dev/lodash@4.17.21
  ",
      "react": "
  https://cdn.skypack.dev/react@17.0.2
  "
    }
  }
</script>
```

**2. WebAssembly æ¨¡å—**

```javascript
// åŠ è½½ wasm æ¨¡å—
import wasmModule from "./math.wasm";

async function useWasm() {
  const module = await wasmModule();
  return module.fibonacci(10);
}
```

### æ–°å…´çš„åŒ…ç®¡ç†å·¥å…·

**1. Deno çš„åŒ…ç®¡ç†**

```typescript
// ç›´æ¥ä» URL å¯¼å…¥
import { serve } from "
https://deno.land/std@0.140.0/http/server.ts
";
import { assertEquals } from "
https://deno.land/std@0.140.0/testing/asserts.ts
";
```

**2. åŒ…ç®¡ç†çš„æœªæ¥æ–¹å‘**

- å»ä¸­å¿ƒåŒ–çš„åŒ…åˆ†å‘
- æ›´å¥½çš„å®‰å…¨æ€§ä¿éšœ
- åŸç”Ÿçš„ monorepo æ”¯æŒ
- æ™ºèƒ½çš„ä¾èµ–è§£æ

---

## æ€»ç»“

å‰ç«¯æ¨¡å—åŒ–å’ŒåŒ…ç®¡ç†çš„å‘å±•å†ç¨‹ä½“ç°äº†å‰ç«¯å·¥ç¨‹åŒ–çš„ä¸æ–­è¿›æ­¥ã€‚ä»æ—©æœŸçš„å…¨å±€å˜é‡æ±¡æŸ“åˆ°ç°åœ¨çš„ ES æ¨¡å—ç³»ç»Ÿï¼Œä»ç®€å•çš„ script æ ‡ç­¾åˆ°å¤æ‚çš„æ„å»ºå·¥å…·é“¾ï¼Œæ¯ä¸€æ¬¡æ¼”è¿›éƒ½æ˜¯ä¸ºäº†è§£å†³æ—¥ç›Šå¤æ‚çš„å‰ç«¯åº”ç”¨éœ€æ±‚ã€‚

**å…³é”®è¦ç‚¹å›é¡¾ï¼š**

1. **æ¨¡å—åŒ–çš„æœ¬è´¨** æ˜¯ä»£ç ç»„ç»‡ã€ä¾èµ–ç®¡ç†å’ŒåŠŸèƒ½å¤ç”¨
2. **ES æ¨¡å—** å·²æˆä¸ºç°ä»£ JavaScript çš„æ ‡å‡†ï¼Œæä¾›äº†é™æ€åˆ†æå’Œ Tree Shaking çš„åŸºç¡€
3. **åŒ…ç®¡ç†å·¥å…·** çš„é€‰æ‹©åº”åŸºäºé¡¹ç›®éœ€æ±‚ã€å›¢é˜Ÿåå¥½å’Œæ€§èƒ½è¦æ±‚
4. **æ„å»ºå·¥å…·** åœ¨æ¨¡å—åŒ–æµç¨‹ä¸­æ‰®æ¼”ç€é‡è¦è§’è‰²ï¼Œéœ€è¦åˆç†é…ç½®ä»¥è·å¾—æœ€ä½³æ€§èƒ½
5. **æ€§èƒ½ä¼˜åŒ–** æ˜¯æ¨¡å—åŒ–çš„é‡è¦ç›®æ ‡ï¼ŒåŒ…æ‹¬ä»£ç åˆ†å‰²ã€ç¼“å­˜ç­–ç•¥å’Œä¾èµ–ä¼˜åŒ–

ä½œä¸ºå‰ç«¯å¼€å‘è€…ï¼Œæˆ‘ä»¬éœ€è¦ï¼š

- æ·±å…¥ç†è§£å„ç§æ¨¡å—ç³»ç»Ÿçš„ç‰¹ç‚¹å’Œé€‚ç”¨åœºæ™¯
- æŒæ¡ç°ä»£åŒ…ç®¡ç†å·¥å…·çš„ä½¿ç”¨æ–¹æ³•å’Œæœ€ä½³å®è·µ
- å…³æ³¨æ„å»ºå·¥å…·çš„å‘å±•è¶‹åŠ¿å’Œä¼˜åŒ–æŠ€å·§
- åœ¨é¡¹ç›®ä¸­åˆç†åº”ç”¨æ¨¡å—åŒ–è®¾è®¡åŸåˆ™

éšç€å‰ç«¯æŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼Œæ¨¡å—åŒ–å’ŒåŒ…ç®¡ç†é¢†åŸŸä¹Ÿä¼šæŒç»­æ¼”è¿›ã€‚ä¿æŒå­¦ä¹ æ€åº¦ï¼Œè·Ÿä¸ŠæŠ€æœ¯å‘å±•çš„æ­¥ä¼ï¼Œæ‰èƒ½åœ¨è¿™ä¸ªå¿«é€Ÿå˜åŒ–çš„é¢†åŸŸä¸­æ¸¸åˆƒæœ‰ä½™ã€‚

æ¨¡å—åŒ–ä¸ä»…ä»…æ˜¯æŠ€æœ¯æ‰‹æ®µï¼Œæ›´æ˜¯ä¸€ç§è½¯ä»¶å·¥ç¨‹æ€ç»´ã€‚é€šè¿‡åˆç†çš„æ¨¡å—åŒ–è®¾è®¡ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ„å»ºå‡ºæ›´åŠ å¯ç»´æŠ¤ã€å¯æ‰©å±•ã€é«˜æ€§èƒ½çš„å‰ç«¯åº”ç”¨ï¼Œä¸ºç”¨æˆ·æä¾›æ›´å¥½çš„ä½“éªŒã€‚ ğŸš€
