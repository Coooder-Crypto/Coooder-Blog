---
title: 'JavaScriptåŸå‹é“¾æ·±åº¦è§£æ: å¯¹è±¡ç»§æ‰¿çš„å¥¥ç§˜ä¹‹æ—…'
date: '2025-9-5'
lastmod: '2025-9-5'
tags: ['javascript', 'prototype', 'inheritance', 'oop', 'frontend']
summary: 'æ·±å…¥æ¢ç´¢JavaScriptåŸå‹é“¾æœºåˆ¶, ä»åŸºç¡€æ¦‚å¿µåˆ°é«˜çº§åº”ç”¨, ç†è§£å¯¹è±¡ç»§æ‰¿ã€å±æ€§æŸ¥æ‰¾ã€æ„é€ å‡½æ•°ç­‰æ ¸å¿ƒåŸç†, æŒæ¡ç°ä»£JavaScriptä¸­åŸå‹çš„å®é™…åº”ç”¨.'
---

å½“ä½ ç¬¬ä¸€æ¬¡æ¥è§¦JavaScriptæ—¶, å¯èƒ½ä¼šè¢«å®ƒç‹¬ç‰¹çš„ç»§æ‰¿æœºåˆ¶æ‰€å›°æƒ‘. ä¸ä¼ ç»Ÿçš„åŸºäºç±»çš„è¯­è¨€ä¸åŒ, JavaScripté‡‡ç”¨åŸºäºåŸå‹çš„ç»§æ‰¿æ¨¡å‹.
è¿™ä¸ªçœ‹ä¼¼å¤æ‚çš„æ¦‚å¿µå®é™…ä¸Šæ˜¯JavaScriptæœ€å¼ºå¤§å’Œçµæ´»çš„ç‰¹æ€§ä¹‹ä¸€, å®ƒä¸ºåŠ¨æ€ç¼–ç¨‹å’Œä»£ç å¤ç”¨æä¾›äº†æ— é™å¯èƒ½.

---

## åŸå‹åŸºç¡€æ¦‚å¿µ: ç†è§£JavaScriptçš„ç»§æ‰¿ä¹‹æº

åœ¨æ·±å…¥åŸå‹é“¾ä¹‹å‰, æˆ‘ä»¬éœ€è¦ç†è§£å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µå’Œå®ƒä»¬ä¹‹é—´çš„å…³ç³».

### ä»€ä¹ˆæ˜¯åŸå‹(Prototype)?

åœ¨JavaScriptä¸­, æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªéšè—çš„å†…éƒ¨å±æ€§ `[[Prototype]]`, å®ƒæŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡. è¿™ä¸ªè¢«æŒ‡å‘çš„å¯¹è±¡å°±æ˜¯åŸå‹.

```javascript
// åˆ›å»ºä¸€ä¸ªç®€å•å¯¹è±¡
const person = {
  name: 'Alice',
  greet() {
    console.log(`Hello, I'm ${this.name}`);
  }
};

// åˆ›å»ºå¦ä¸€ä¸ªå¯¹è±¡, ä»¥personä¸ºåŸå‹
const student = Object.create(person);
student.name = 'Bob';
student.study = function() {
  console.log(`${this.name} is studying`);
};

student.greet(); // "Hello, I'm Bob" - ä»åŸå‹ç»§æ‰¿çš„æ–¹æ³•
student.study(); // "Bob is studying" - è‡ªå·±çš„æ–¹æ³•
```

**ä¸‰ä¸ªé‡è¦å±æ€§çš„åŒºåˆ«**:

1. `[[Prototype]]`: å¯¹è±¡çš„å†…éƒ¨åŸå‹å¼•ç”¨(ä¸å¯ç›´æ¥è®¿é—®)
2. `__proto__`: è®¿é—®`[[Prototype]]`çš„éæ ‡å‡†æ–¹å¼(å·²åºŸå¼ƒ)
3. `prototype`: å‡½æ•°çš„åŸå‹å¯¹è±¡å±æ€§(ç”¨äºæ„é€ å‡½æ•°)

```javascript
function Person(name) {
  this.name = name;
}

Person.prototype.greet = function() {
  console.log(`Hello, I'm ${this.name}`);
};

const alice = new Person('Alice');

console.log(alice.__proto__ === Person.prototype); // true
console.log(Object.getPrototypeOf(alice) === Person.prototype); // true (æ ‡å‡†æ–¹å¼)
```

ğŸ“Œ **é‡è¦æç¤º**: å§‹ç»ˆä½¿ç”¨ `Object.getPrototypeOf()` å’Œ `Object.setPrototypeOf()` æ¥æ“ä½œåŸå‹, é¿å…ä½¿ç”¨å·²åºŸå¼ƒçš„ `__proto__`.

### åŸå‹é“¾çš„å·¥ä½œæœºåˆ¶

åŸå‹é“¾æ˜¯ä¸€ä¸ªé“¾å¼æŸ¥æ‰¾è¿‡ç¨‹. å½“è®¿é—®å¯¹è±¡å±æ€§æ—¶, JavaScriptå¼•æ“ä¼šæŒ‰ç…§ä»¥ä¸‹é¡ºåºæŸ¥æ‰¾:

```javascript
const grandParent = {
  species: 'human',
  speak() {
    console.log('Speaking...');
  }
};

const parent = Object.create(grandParent);
parent.canWalk = true;

const child = Object.create(parent);
child.name = 'Tom';
child.age = 5;

// å±æ€§æŸ¥æ‰¾è¿‡ç¨‹
console.log(child.name);     // "Tom" - åœ¨childå¯¹è±¡ä¸Šæ‰¾åˆ°
console.log(child.canWalk);  // true - åœ¨parentåŸå‹ä¸Šæ‰¾åˆ°
console.log(child.species);  // "human" - åœ¨grandParentåŸå‹ä¸Šæ‰¾åˆ°
console.log(child.fly);      // undefined - æ•´æ¡é“¾ä¸Šéƒ½æ²¡æ‰¾åˆ°
```

**æŸ¥æ‰¾ç®—æ³•è¯¦è§£**:

```javascript
// ä¼ªä»£ç æè¿°å±æ€§æŸ¥æ‰¾è¿‡ç¨‹
function getProperty(obj, prop) {
  let current = obj;
  
  while (current !== null) {
    if (current.hasOwnProperty(prop)) {
      return current[prop];
    }
    current = Object.getPrototypeOf(current);
  }
  
  return undefined;
}
```

---

## æ„é€ å‡½æ•°ä¸åŸå‹: å¯¹è±¡åˆ›å»ºçš„ç»å…¸æ¨¡å¼

æ„é€ å‡½æ•°æ˜¯JavaScriptä¸­åˆ›å»ºå¯¹è±¡çš„ä¼ ç»Ÿæ–¹å¼, ç†è§£å®ƒä¸åŸå‹çš„å…³ç³»æ˜¯æŒæ¡ç»§æ‰¿çš„å…³é”®.

### æ„é€ å‡½æ•°çš„åŸå‹æœºåˆ¶

æ¯ä¸ªå‡½æ•°åœ¨åˆ›å»ºæ—¶éƒ½ä¼šè‡ªåŠ¨è·å¾—ä¸€ä¸ª`prototype`å±æ€§:

```javascript
function Animal(name) {
  this.name = name;
  this.energy = 100;
}

// åœ¨åŸå‹ä¸Šå®šä¹‰å…±äº«æ–¹æ³•
Animal.prototype.eat = function(food) {
  console.log(`${this.name} is eating ${food}`);
  this.energy += 10;
};

Animal.prototype.sleep = function() {
  console.log(`${this.name} is sleeping`);
  this.energy += 20;
};

Animal.prototype.play = function() {
  console.log(`${this.name} is playing`);
  this.energy -= 10;
};

// åˆ›å»ºå®ä¾‹
const cat = new Animal('Whiskers');
const dog = new Animal('Buddy');

cat.eat('fish');   // "Whiskers is eating fish"
dog.play();        // "Buddy is playing"

// æ‰€æœ‰å®ä¾‹å…±äº«åŸå‹æ–¹æ³•
console.log(cat.eat === dog.eat); // true - åŒä¸€ä¸ªå‡½æ•°å¼•ç”¨
```

**æ„é€ å‡½æ•°æ‰§è¡Œè¿‡ç¨‹**:

```javascript
// new Animal('Whiskers') çš„æ‰§è¡Œè¿‡ç¨‹:

// 1. åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡
const newObj = {};

// 2. è®¾ç½®æ–°å¯¹è±¡çš„åŸå‹
Object.setPrototypeOf(newObj, Animal.prototype);
// ç­‰ä»·äº: newObj.__proto__ = Animal.prototype;

// 3. æ‰§è¡Œæ„é€ å‡½æ•°, thisæŒ‡å‘æ–°å¯¹è±¡
Animal.call(newObj, 'Whiskers');

// 4. è¿”å›æ–°å¯¹è±¡(é™¤éæ„é€ å‡½æ•°æ˜¾å¼è¿”å›å…¶ä»–å¯¹è±¡)
return newObj;
```

### åŸå‹æ–¹æ³• vs å®ä¾‹æ–¹æ³•

ç†è§£æ–¹æ³•å®šä¹‰ä½ç½®çš„å½±å“å¯¹æ€§èƒ½å’Œå†…å­˜ä½¿ç”¨å¾ˆé‡è¦:

```javascript
function Person(name) {
  this.name = name;
  
  // âŒ ä¸æ¨è: æ¯ä¸ªå®ä¾‹éƒ½åˆ›å»ºæ–°å‡½æ•°
  this.greetBad = function() {
    console.log(`Hello, I'm ${this.name}`);
  };
}

// âœ… æ¨è: æ‰€æœ‰å®ä¾‹å…±äº«åŒä¸€ä¸ªå‡½æ•°
Person.prototype.greet = function() {
  console.log(`Hello, I'm ${this.name}`);
};

const person1 = new Person('Alice');
const person2 = new Person('Bob');

// å†…å­˜å¯¹æ¯”
console.log(person1.greetBad === person2.greetBad); // false - ä¸åŒå‡½æ•°
console.log(person1.greet === person2.greet);       // true - åŒä¸€å‡½æ•°

// æ€§èƒ½æµ‹è¯•
console.time('prototype method');
for (let i = 0; i < 1000000; i++) {
  person1.greet();
}
console.timeEnd('prototype method');
```

**æœ€ä½³å®è·µ**:

```javascript
function Vehicle(brand, model) {
  // å®ä¾‹å±æ€§
  this.brand = brand;
  this.model = model;
  this.speed = 0;
  
  // é¿å…åœ¨æ„é€ å‡½æ•°ä¸­å®šä¹‰æ–¹æ³•
}

// åŸå‹æ–¹æ³• - æ‰€æœ‰å®ä¾‹å…±äº«
Vehicle.prototype.accelerate = function(increment = 10) {
  this.speed += increment;
  console.log(`${this.brand} ${this.model} accelerating to ${this.speed} km/h`);
};

Vehicle.prototype.brake = function(decrement = 10) {
  this.speed = Math.max(0, this.speed - decrement);
  console.log(`${this.brand} ${this.model} slowing down to ${this.speed} km/h`);
};

// é™æ€æ–¹æ³• - å±äºæ„é€ å‡½æ•°æœ¬èº«
Vehicle.compare = function(vehicle1, vehicle2) {
  return vehicle1.speed - vehicle2.speed;
};
```

---

## åŸå‹ç»§æ‰¿çš„å®ç°æ–¹å¼

JavaScriptæä¾›äº†å¤šç§å®ç°ç»§æ‰¿çš„æ–¹å¼, ä»ä¼ ç»Ÿçš„åŸå‹é“¾åˆ°ç°ä»£çš„classè¯­æ³•.

### ç»å…¸åŸå‹ç»§æ‰¿

```javascript
// çˆ¶ç±»æ„é€ å‡½æ•°
function Animal(name) {
  this.name = name;
  this.alive = true;
}

Animal.prototype.breathe = function() {
  console.log(`${this.name} is breathing`);
};

Animal.prototype.move = function() {
  console.log(`${this.name} is moving`);
};

// å­ç±»æ„é€ å‡½æ•°
function Dog(name, breed) {
  // è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°
  Animal.call(this, name);
  this.breed = breed;
}

// å»ºç«‹åŸå‹ç»§æ‰¿å…³ç³»
Dog.prototype = Object.create(Animal.prototype);
Dog.prototype.constructor = Dog;

// æ·»åŠ å­ç±»ç‰¹æœ‰æ–¹æ³•
Dog.prototype.bark = function() {
  console.log(`${this.name} is barking: Woof!`);
};

Dog.prototype.wagTail = function() {
  console.log(`${this.name} is wagging tail`);
};

// æ–¹æ³•é‡å†™
Dog.prototype.move = function() {
  console.log(`${this.name} is running on four legs`);
};

const buddy = new Dog('Buddy', 'Golden Retriever');
buddy.breathe(); // ç»§æ‰¿çš„æ–¹æ³•
buddy.bark();    // è‡ªå·±çš„æ–¹æ³•
buddy.move();    // é‡å†™çš„æ–¹æ³•
```

**ç»§æ‰¿é“¾æ£€æŸ¥**:

```javascript
console.log(buddy instanceof Dog);    // true
console.log(buddy instanceof Animal); // true
console.log(buddy instanceof Object); // true

// åŸå‹é“¾å…³ç³»
console.log(Object.getPrototypeOf(buddy) === Dog.prototype);                    // true
console.log(Object.getPrototypeOf(Dog.prototype) === Animal.prototype);        // true
console.log(Object.getPrototypeOf(Animal.prototype) === Object.prototype);     // true
console.log(Object.getPrototypeOf(Object.prototype) === null);                 // true
```

### å·¥å‚å‡½æ•°æ¨¡å¼

ä¸ä½¿ç”¨æ„é€ å‡½æ•°çš„ç»§æ‰¿æ–¹å¼:

```javascript
// çˆ¶å¯¹è±¡å·¥å‚
function createAnimal(name) {
  const animal = Object.create(animalMethods);
  animal.name = name;
  animal.alive = true;
  return animal;
}

const animalMethods = {
  breathe() {
    console.log(`${this.name} is breathing`);
  },
  move() {
    console.log(`${this.name} is moving`);
  }
};

// å­å¯¹è±¡å·¥å‚
function createDog(name, breed) {
  const dog = createAnimal(name);
  Object.setPrototypeOf(dog, dogMethods);
  dog.breed = breed;
  return dog;
}

const dogMethods = Object.create(animalMethods);
dogMethods.bark = function() {
  console.log(`${this.name} is barking: Woof!`);
};

dogMethods.move = function() {
  console.log(`${this.name} is running on four legs`);
};

const rex = createDog('Rex', 'German Shepherd');
rex.breathe(); // ç»§æ‰¿çš„æ–¹æ³•
rex.bark();    // å­ç±»æ–¹æ³•
```

### ç»„åˆç»§æ‰¿çš„é—®é¢˜ä¸è§£å†³

ä¼ ç»Ÿç»§æ‰¿æ¨¡å¼çš„é—®é¢˜:

```javascript
function Parent(name) {
  this.name = name;
  this.colors = ['red', 'blue'];
}

Parent.prototype.getName = function() {
  return this.name;
};

function Child(name, age) {
  Parent.call(this, name); // ç¬¬ä¸€æ¬¡è°ƒç”¨Parentæ„é€ å‡½æ•°
  this.age = age;
}

// ç¬¬äºŒæ¬¡è°ƒç”¨Parentæ„é€ å‡½æ•°
Child.prototype = new Parent();
Child.prototype.constructor = Child;

// é—®é¢˜: Parentæ„é€ å‡½æ•°è¢«è°ƒç”¨ä¸¤æ¬¡
// é—®é¢˜: Child.prototypeä¸Šå­˜åœ¨å¤šä½™çš„å±æ€§
```

**å¯„ç”Ÿç»„åˆç»§æ‰¿ - æœ€ä¼˜è§£å†³æ–¹æ¡ˆ**:

```javascript
function inheritPrototype(child, parent) {
  const prototype = Object.create(parent.prototype);
  prototype.constructor = child;
  child.prototype = prototype;
}

function Parent(name) {
  this.name = name;
  this.colors = ['red', 'blue'];
}

Parent.prototype.getName = function() {
  return this.name;
};

function Child(name, age) {
  Parent.call(this, name); // åªè°ƒç”¨ä¸€æ¬¡
  this.age = age;
}

inheritPrototype(Child, Parent); // å»ºç«‹ç»§æ‰¿å…³ç³»

Child.prototype.getAge = function() {
  return this.age;
};

const child = new Child('Tom', 10);
console.log(child.getName()); // "Tom"
console.log(child.getAge());  // 10
```

---

## ES6+ ç°ä»£ç»§æ‰¿è¯­æ³•

ES6å¼•å…¥çš„classè¯­æ³•ä¸ºJavaScriptæä¾›äº†æ›´æ¸…æ™°çš„ç»§æ‰¿è¯­æ³•.

### ClassåŸºç¡€è¯­æ³•

```javascript
class Animal {
  // ç±»å­—æ®µ(ES2022)
  #energy = 100; // ç§æœ‰å­—æ®µ
  
  constructor(name, species) {
    this.name = name;
    this.species = species;
  }
  
  // å®ä¾‹æ–¹æ³•
  eat(food) {
    this.#energy += 10;
    console.log(`${this.name} is eating ${food}. Energy: ${this.#energy}`);
  }
  
  sleep() {
    this.#energy += 20;
    console.log(`${this.name} is sleeping. Energy: ${this.#energy}`);
  }
  
  // Getterå’ŒSetter
  get energy() {
    return this.#energy;
  }
  
  set energy(value) {
    if (value < 0) {
      throw new Error('Energy cannot be negative');
    }
    this.#energy = value;
  }
  
  // é™æ€æ–¹æ³•
  static compare(animal1, animal2) {
    return animal1.energy - animal2.energy;
  }
  
  // é™æ€å­—æ®µ
  static kingdom = 'Animalia';
}

const lion = new Animal('Leo', 'Lion');
lion.eat('meat');
console.log(lion.energy); // 110
```

### Classç»§æ‰¿

```javascript
class Mammal extends Animal {
  constructor(name, species, furColor) {
    super(name, species); // è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°
    this.furColor = furColor;
    this.warmBlooded = true;
  }
  
  // æ–¹æ³•é‡å†™
  eat(food) {
    super.eat(food); // è°ƒç”¨çˆ¶ç±»æ–¹æ³•
    this.groom();
  }
  
  // æ–°æ–¹æ³•
  groom() {
    console.log(`${this.name} is grooming its ${this.furColor} fur`);
  }
  
  giveBirth() {
    console.log(`${this.name} is giving birth to live young`);
  }
}

class Dog extends Mammal {
  constructor(name, breed, furColor) {
    super(name, 'Canis lupus', furColor);
    this.breed = breed;
    this.loyalty = 100;
  }
  
  bark(intensity = 'normal') {
    const sounds = {
      quiet: 'woof',
      normal: 'Woof!',
      loud: 'WOOF WOOF!'
    };
    console.log(`${this.name} barks: ${sounds[intensity]}`);
  }
  
  // å¼‚æ­¥æ–¹æ³•ç¤ºä¾‹
  async fetchToy() {
    console.log(`${this.name} is looking for a toy...`);
    await new Promise(resolve => setTimeout(resolve, 1000));
    console.log(`${this.name} found a ball!`);
    return 'ball';
  }
  
  // é‡å†™toString
  toString() {
    return `${this.name} - ${this.breed} dog with ${this.furColor} fur`;
  }
}

const buddy = new Dog('Buddy', 'Golden Retriever', 'golden');
buddy.eat('kibble');  // è°ƒç”¨é‡å†™çš„æ–¹æ³•
buddy.bark('loud');   // è°ƒç”¨è‡ªå·±çš„æ–¹æ³•
console.log(buddy.toString());
```

### Mixinæ¨¡å¼ - å¤šé‡ç»§æ‰¿çš„å®ç°

JavaScriptä¸æ”¯æŒå¤šé‡ç»§æ‰¿, ä½†å¯ä»¥é€šè¿‡Mixinå®ç°ç±»ä¼¼åŠŸèƒ½:

```javascript
// Mixinå®šä¹‰
const Flyable = {
  fly() {
    console.log(`${this.name} is flying at altitude ${this.altitude}m`);
  },
  
  land() {
    this.altitude = 0;
    console.log(`${this.name} has landed`);
  }
};

const Swimmable = {
  swim() {
    console.log(`${this.name} is swimming at depth ${this.depth}m`);
  },
  
  dive(targetDepth) {
    this.depth = targetDepth;
    console.log(`${this.name} dived to ${targetDepth}m`);
  }
};

// Mixinè¾…åŠ©å‡½æ•°
function mixin(target, ...sources) {
  sources.forEach(source => {
    Object.getOwnPropertyNames(source).forEach(name => {
      if (name !== 'constructor') {
        target.prototype[name] = source[name];
      }
    });
  });
  return target;
}

// åº”ç”¨Mixin
class Bird extends Animal {
  constructor(name, species, wingspan) {
    super(name, species);
    this.wingspan = wingspan;
    this.altitude = 0;
  }
}

class Duck extends Bird {
  constructor(name, wingspan) {
    super(name, 'Duck', wingspan);
    this.depth = 0;
  }
}

// æ··å…¥å¤šä¸ªèƒ½åŠ›
mixin(Duck, Flyable, Swimmable);

const mallard = new Duck('Donald', 0.8);
mallard.fly();      // æ¥è‡ªFlyable
mallard.dive(2);    // æ¥è‡ªSwimmable
mallard.swim();     // æ¥è‡ªSwimmable
mallard.land();     // æ¥è‡ªFlyable
```

---

## åŸå‹é“¾çš„é«˜çº§åº”ç”¨

æŒæ¡äº†åŸºç¡€çŸ¥è¯†å, æˆ‘ä»¬å¯ä»¥æ¢ç´¢ä¸€äº›é«˜çº§åº”ç”¨åœºæ™¯.

### åŠ¨æ€åŸå‹ä¿®æ”¹

JavaScriptå…è®¸åœ¨è¿è¡Œæ—¶ä¿®æ”¹åŸå‹, è¿™æ˜¯å…¶åŠ¨æ€ç‰¹æ€§çš„ä½“ç°:

```javascript
function Person(name) {
  this.name = name;
}

const alice = new Person('Alice');
const bob = new Person('Bob');

// åŠ¨æ€æ·»åŠ æ–¹æ³•åˆ°åŸå‹
Person.prototype.greet = function() {
  console.log(`Hello, I'm ${this.name}`);
};

// æ‰€æœ‰å®ä¾‹ç«‹å³è·å¾—æ–°æ–¹æ³•
alice.greet(); // "Hello, I'm Alice"
bob.greet();   // "Hello, I'm Bob"

// åŠ¨æ€æ·»åŠ å±æ€§
Person.prototype.species = 'Homo sapiens';
console.log(alice.species); // "Homo sapiens"

// æ–¹æ³•é‡å†™å’ŒåŸå§‹æ–¹æ³•ä¿å­˜
const originalGreet = Person.prototype.greet;
Person.prototype.greet = function() {
  originalGreet.call(this);
  console.log('Nice to meet you!');
};

alice.greet();
// "Hello, I'm Alice"
// "Nice to meet you!"
```

**æ³¨æ„äº‹é¡¹**:

- ä¿®æ”¹å†…ç½®å¯¹è±¡åŸå‹è¦è°¨æ…
- å¯èƒ½å½±å“ç¬¬ä¸‰æ–¹åº“
- æ€§èƒ½å¼€é”€éœ€è¦è€ƒè™‘

```javascript
// âŒ ä¸æ¨è: ä¿®æ”¹å†…ç½®åŸå‹
Array.prototype.last = function() {
  return this[this.length - 1];
};

// âœ… æ¨è: ä½¿ç”¨å·¥å…·å‡½æ•°
function getLastItem(array) {
  return array[array.length - 1];
}

// æˆ–è€…ä½¿ç”¨æ›´ç°ä»£çš„æ–¹å¼
const last = arr => arr[arr.length - 1];
```

### åŸå‹ä»£ç†å’Œæ‹¦æˆª

ä½¿ç”¨Proxyå¯ä»¥æ‹¦æˆªåŸå‹æ“ä½œ:

```javascript
class SmartObject {
  constructor() {
    this.data = new Map();
    
    return new Proxy(this, {
      get(target, prop) {
        // è®°å½•å±æ€§è®¿é—®
        console.log(`Accessing property: ${prop}`);
        
        if (target.data.has(prop)) {
          return target.data.get(prop);
        }
        
        return target[prop];
      },
      
      set(target, prop, value) {
        console.log(`Setting property: ${prop} = ${value}`);
        
        if (typeof prop === 'string' && prop.startsWith('_')) {
          console.warn(`Warning: Setting private property ${prop}`);
        }
        
        target.data.set(prop, value);
        return true;
      },
      
      has(target, prop) {
        return target.data.has(prop) || prop in target;
      }
    });
  }
  
  toJSON() {
    return Object.fromEntries(this.data);
  }
}

const obj = new SmartObject();
obj.name = 'John';        // Setting property: name = John
obj._secret = 'hidden';   // Warning: Setting private property _secret
console.log(obj.name);    // Accessing property: name
```

### åŸå‹æ±¡æŸ“é˜²æŠ¤

åŸå‹æ±¡æŸ“æ˜¯ä¸€ä¸ªå®‰å…¨é—®é¢˜, éœ€è¦é‡‡å–é˜²æŠ¤æªæ–½:

```javascript
// é˜²æ­¢åŸå‹æ±¡æŸ“çš„å®‰å…¨å‡½æ•°
function safeAssign(target, source) {
  const dangerousKeys = ['__proto__', 'constructor', 'prototype'];
  
  for (const key in source) {
    if (dangerousKeys.includes(key)) {
      console.warn(`Skipping dangerous key: ${key}`);
      continue;
    }
    
    if (typeof key === 'string' && key.includes('prototype')) {
      console.warn(`Skipping suspicious key: ${key}`);
      continue;
    }
    
    target[key] = source[key];
  }
  
  return target;
}

// åˆ›å»ºå®‰å…¨çš„å¯¹è±¡
function createSecureObject() {
  const obj = Object.create(null); // æ²¡æœ‰åŸå‹é“¾
  return new Proxy(obj, {
    set(target, prop, value) {
      if (prop === '__proto__') {
        throw new Error('Prototype pollution attempt blocked');
      }
      target[prop] = value;
      return true;
    }
  });
}

const secureObj = createSecureObject();
secureObj.data = 'safe';
// secureObj.__proto__ = {}; // Error: Prototype pollution attempt blocked
```

---

## æ€§èƒ½è€ƒè™‘ä¸æœ€ä½³å®è·µ

åœ¨å®é™…å¼€å‘ä¸­, åŸå‹é“¾çš„ä½¿ç”¨éœ€è¦è€ƒè™‘æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§.

### åŸå‹æŸ¥æ‰¾çš„æ€§èƒ½å½±å“

```javascript
// æ€§èƒ½æµ‹è¯•: ä¸åŒæ·±åº¦çš„åŸå‹é“¾
function createChain(depth) {
  let current = {};
  const root = current;
  
  for (let i = 0; i < depth; i++) {
    const next = {};
    Object.setPrototypeOf(current, next);
    current = next;
  }
  
  // åœ¨æœ€é¡¶å±‚æ·»åŠ å±æ€§
  current.deepProperty = 'found';
  
  return root;
}

// æµ‹è¯•ä¸åŒæ·±åº¦çš„æŸ¥æ‰¾æ€§èƒ½
function testLookupPerformance() {
  const depths = [1, 5, 10, 20, 50];
  const iterations = 1000000;
  
  depths.forEach(depth => {
    const obj = createChain(depth);
    
    console.time(`Depth ${depth}`);
    for (let i = 0; i < iterations; i++) {
      obj.deepProperty; // æŸ¥æ‰¾å±æ€§
    }
    console.timeEnd(`Depth ${depth}`);
  });
}

testLookupPerformance();
```

**æ€§èƒ½ä¼˜åŒ–å»ºè®®**:

```javascript
class OptimizedClass {
  constructor() {
    // é¢„åˆ†é…å¸¸ç”¨å±æ€§, é¿å…åŠ¨æ€æ·»åŠ 
    this.x = 0;
    this.y = 0;
    this.visible = true;
    this.cached = null;
  }
  
  expensiveOperation() {
    // ä½¿ç”¨ç¼“å­˜é¿å…é‡å¤è®¡ç®—
    if (this.cached !== null) {
      return this.cached;
    }
    
    // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
    let result = 0;
    for (let i = 0; i < 1000000; i++) {
      result += Math.random();
    }
    
    this.cached = result;
    return result;
  }
  
  // ç›´æ¥åœ¨å®ä¾‹ä¸Šå®šä¹‰çƒ­ç‚¹æ–¹æ³•
  hotMethod() {
    return this.x * this.y;
  }
}

// å¯¹äºéœ€è¦å¤§é‡å®ä¾‹çš„åœºæ™¯, è€ƒè™‘å¯¹è±¡æ± 
class ObjectPool {
  constructor(createFn, resetFn, initialSize = 10) {
    this.createFn = createFn;
    this.resetFn = resetFn;
    this.pool = [];
    
    // é¢„åˆ›å»ºå¯¹è±¡
    for (let i = 0; i < initialSize; i++) {
      this.pool.push(this.createFn());
    }
  }
  
  acquire() {
    return this.pool.pop() || this.createFn();
  }
  
  release(obj) {
    this.resetFn(obj);
    this.pool.push(obj);
  }
}
```

### å†…å­˜æ³„æ¼é¢„é˜²

åŸå‹é“¾ä½¿ç”¨ä¸å½“å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼:

```javascript
class EventEmitter {
  constructor() {
    this.listeners = new Map();
  }
  
  on(event, callback) {
    if (!this.listeners.has(event)) {
      this.listeners.set(event, []);
    }
    this.listeners.get(event).push(callback);
    
    // è¿”å›æ¸…ç†å‡½æ•°
    return () => this.off(event, callback);
  }
  
  off(event, callback) {
    if (!this.listeners.has(event)) return;
    
    const callbacks = this.listeners.get(event);
    const index = callbacks.indexOf(callback);
    if (index > -1) {
      callbacks.splice(index, 1);
    }
    
    if (callbacks.length === 0) {
      this.listeners.delete(event);
    }
  }
  
  emit(event, ...args) {
    if (!this.listeners.has(event)) return;
    
    this.listeners.get(event).forEach(callback => {
      try {
        callback(...args);
      } catch (error) {
        console.error('Event callback error:', error);
      }
    });
  }
  
  // é‡è¦: æä¾›æ¸…ç†æ–¹æ³•
  destroy() {
    this.listeners.clear();
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const emitter = new EventEmitter();

// è‡ªåŠ¨æ¸…ç†çš„ç›‘å¬å™¨
const cleanup = emitter.on('data', (data) => {
  console.log('Received data:', data);
});

// åœ¨é€‚å½“æ—¶æœºæ¸…ç†
window.addEventListener('beforeunload', cleanup);
```

---

## è°ƒè¯•å’Œå·¥å…·

æŒæ¡è°ƒè¯•åŸå‹é“¾çš„å·¥å…·å’ŒæŠ€å·§å¯¹å¼€å‘å¾ˆæœ‰å¸®åŠ©.

### åŸå‹é“¾æ£€æŸ¥å·¥å…·

```javascript
// é€šç”¨åŸå‹é“¾åˆ†æå‡½æ•°
function analyzePrototypeChain(obj, maxDepth = 10) {
  const chain = [];
  let current = obj;
  let depth = 0;
  
  while (current && depth < maxDepth) {
    const info = {
      depth,
      object: current,
      constructor: current.constructor?.name || 'Unknown',
      ownProperties: Object.getOwnPropertyNames(current),
      methods: []
    };
    
    // æ”¶é›†æ–¹æ³•
    Object.getOwnPropertyNames(current).forEach(name => {
      if (typeof current[name] === 'function') {
        info.methods.push(name);
      }
    });
    
    chain.push(info);
    current = Object.getPrototypeOf(current);
    depth++;
  }
  
  return chain;
}

// ä½¿ç”¨ç¤ºä¾‹
class A {}
class B extends A {}
class C extends B {}

const instance = new C();
const analysis = analyzePrototypeChain(instance);

console.table(analysis.map(item => ({
  depth: item.depth,
  constructor: item.constructor,
  properties: item.ownProperties.length,
  methods: item.methods.length
})));
```

### å®æ—¶ç›‘æ§åŸå‹ä¿®æ”¹

```javascript
// ç›‘æ§åŸå‹ä¿®æ”¹çš„å·¥å…·
function watchPrototype(constructor, callback) {
  const original = constructor.prototype;
  const handler = {
    set(target, prop, value) {
      callback({
        action: 'set',
        property: prop,
        value: value,
        target: target
      });
      target[prop] = value;
      return true;
    },
    
    deleteProperty(target, prop) {
      callback({
        action: 'delete',
        property: prop,
        target: target
      });
      delete target[prop];
      return true;
    }
  };
  
  constructor.prototype = new Proxy(original, handler);
  return () => {
    constructor.prototype = original; // æ¢å¤åŸå§‹åŸå‹
  };
}

// ä½¿ç”¨ç¤ºä¾‹
class TestClass {}
const stopWatching = watchPrototype(TestClass, (change) => {
  console.log('Prototype changed:', change);
});

TestClass.prototype.newMethod = function() {
  return 'added';
}; // è§¦å‘ç›‘æ§

delete TestClass.prototype.newMethod; // è§¦å‘ç›‘æ§
stopWatching(); // åœæ­¢ç›‘æ§
```

---

## ç°ä»£JavaScriptçš„æ›¿ä»£æ–¹æ¡ˆ

éšç€JavaScriptçš„å‘å±•, å‡ºç°äº†ä¸€äº›åŸå‹é“¾çš„æ›¿ä»£æˆ–è¡¥å……æ–¹æ¡ˆ.

### ç»„åˆä¼˜äºç»§æ‰¿

```javascript
// ä¼ ç»Ÿç»§æ‰¿æ–¹å¼
class FlyingBird extends Bird {
  fly() { /* ... */ }
}

class SwimmingBird extends Bird {
  swim() { /* ... */ }
}

// é—®é¢˜: å¦‚æœéœ€è¦ä¼šé£åˆä¼šæ¸¸æ³³çš„é¸Ÿæ€ä¹ˆåŠ?

// ç»„åˆæ–¹å¼
const flyBehavior = {
  fly() {
    console.log(`${this.name} is flying`);
  }
};

const swimBehavior = {
  swim() {
    console.log(`${this.name} is swimming`);
  }
};

const walkBehavior = {
  walk() {
    console.log(`${this.name} is walking`);
  }
};

class Bird {
  constructor(name, behaviors = []) {
    this.name = name;
    
    // åŠ¨æ€æ··å…¥è¡Œä¸º
    behaviors.forEach(behavior => {
      Object.assign(this, behavior);
    });
  }
}

// åˆ›å»ºä¸åŒèƒ½åŠ›çš„é¸Ÿ
const eagle = new Bird('Eagle', [flyBehavior]);
const duck = new Bird('Duck', [flyBehavior, swimBehavior, walkBehavior]);
const penguin = new Bird('Penguin', [swimBehavior, walkBehavior]);

eagle.fly();    // âœ…
duck.swim();    // âœ…
duck.fly();     // âœ…
penguin.walk(); // âœ…
// penguin.fly(); // undefined - æ²¡æœ‰æ­¤èƒ½åŠ›
```

### WeakMapç§æœ‰å±æ€§

ä½¿ç”¨WeakMapå®ç°çœŸæ­£çš„ç§æœ‰å±æ€§:

```javascript
const privateData = new WeakMap();

class SecureClass {
  constructor(secret) {
    privateData.set(this, {
      secret: secret,
      internalCounter: 0
    });
  }
  
  getSecret() {
    return privateData.get(this).secret;
  }
  
  increment() {
    const data = privateData.get(this);
    data.internalCounter++;
    return data.internalCounter;
  }
  
  // å¤–éƒ¨æ— æ³•è®¿é—®privateDataä¸­çš„æ•°æ®
}

const instance = new SecureClass('top-secret');
console.log(instance.getSecret()); // "top-secret"
console.log(instance.increment()); // 1

// æ— æ³•ç›´æ¥è®¿é—®ç§æœ‰æ•°æ®
console.log(instance.secret);      // undefined
console.log(Object.keys(instance)); // []
```

### å‡½æ•°å¼ç¼–ç¨‹æ–¹æ³•

```javascript
// å‡½æ•°å¼çš„"ç»§æ‰¿"æ–¹å¼
const createAnimal = (name) => ({
  name,
  speak: () => console.log(`${name} makes a sound`)
});

const createDog = (name, breed) => ({
  ...createAnimal(name),
  breed,
  speak: () => console.log(`${name} barks`),
  wagTail: () => console.log(`${name} wags tail`)
});

const createCat = (name, color) => ({
  ...createAnimal(name),
  color,
  speak: () => console.log(`${name} meows`),
  purr: () => console.log(`${name} purrs`)
});

// ä½¿ç”¨
const dog = createDog('Buddy', 'Golden Retriever');
const cat = createCat('Whiskers', 'tabby');

dog.speak(); // "Buddy barks"
cat.purr();  // "Whiskers purrs"

// ä¼˜åŠ¿: ç®€å•ã€å¯é¢„æµ‹ã€æ˜“æµ‹è¯•
// åŠ£åŠ¿: æ¯ä¸ªå®ä¾‹éƒ½æœ‰æ–¹æ³•çš„å‰¯æœ¬(å†…å­˜å ç”¨)
```

---

## æ€»ç»“ä¸æœ€ä½³å®è·µ

JavaScriptçš„åŸå‹é“¾æ˜¯ä¸€ä¸ªå¼ºå¤§è€Œçµæ´»çš„ç‰¹æ€§, ç†è§£å®ƒçš„å·¥ä½œåŸç†å¯¹æˆä¸ºä¼˜ç§€çš„JavaScriptå¼€å‘è€…è‡³å…³é‡è¦.

### æ ¸å¿ƒè¦ç‚¹å›é¡¾

1. **åŸå‹é“¾æ˜¯å±æ€§æŸ¥æ‰¾æœºåˆ¶**: å½“è®¿é—®å¯¹è±¡å±æ€§æ—¶, ä¼šæ²¿ç€åŸå‹é“¾å‘ä¸ŠæŸ¥æ‰¾
2. **æ„é€ å‡½æ•°çš„`prototype`å±æ€§**: å†³å®šäº†å®ä¾‹å¯¹è±¡çš„åŸå‹
3. **`Object.getPrototypeOf()`**: æ ‡å‡†çš„è·å–å¯¹è±¡åŸå‹çš„æ–¹å¼
4. **ç»§æ‰¿çš„å¤šç§å®ç°**: ä»æ„é€ å‡½æ•°åˆ°ES6 class, å„æœ‰ä¼˜åŠ£
5. **æ€§èƒ½è€ƒè™‘**: è¿‡æ·±çš„åŸå‹é“¾ä¼šå½±å“å±æ€§è®¿é—®æ€§èƒ½

### æœ€ä½³å®è·µæ€»ç»“

```javascript
// âœ… æ¨èçš„åšæ³•

// 1. ä½¿ç”¨ES6+ classè¯­æ³•(æ¸…æ™°ç®€æ´)
class Animal {
  constructor(name) {
    this.name = name;
  }
  
  speak() {
    console.log(`${this.name} makes a sound`);
  }
}

// 2. ä¼˜å…ˆç»„åˆè€Œéç»§æ‰¿
class Dog {
  constructor(name, behaviors) {
    this.name = name;
    this.behaviors = behaviors;
  }
  
  performBehavior(behaviorName) {
    if (this.behaviors[behaviorName]) {
      this.behaviors[behaviorName].call(this);
    }
  }
}

// 3. ä½¿ç”¨Object.create()åˆ›å»ºåŸå‹å…³ç³»
const dogPrototype = Object.create(Animal.prototype);

// 4. é¿å…ä¿®æ”¹å†…ç½®åŸå‹
// Array.prototype.customMethod = ... // âŒ

// 5. ä½¿ç”¨ç§æœ‰å­—æ®µ(ES2022)
class ModernClass {
  #privateField = 'secret';
  
  getPrivateField() {
    return this.#privateField;
  }
}
```

### å¸¸è§é™·é˜±é¿å…

```javascript
// âŒ å¸¸è§é”™è¯¯
function Constructor() {}
Constructor.prototype = {
  method: function() {}
  // å¿˜è®°è®¾ç½®constructorå±æ€§
};

// âœ… æ­£ç¡®åšæ³•
function Constructor() {}
Constructor.prototype = {
  constructor: Constructor,
  method: function() {}
};

// âŒ åŸå‹æ±¡æŸ“é£é™©
function unsafeExtend(target, source) {
  for (let key in source) {
    target[key] = source[key]; // å±é™©!
  }
}

// âœ… å®‰å…¨çš„æ‰©å±•
function safeExtend(target, source) {
  const safeKeys = Object.keys(source).filter(key => 
    !['__proto__', 'constructor', 'prototype'].includes(key)
  );
  safeKeys.forEach(key => {
    target[key] = source[key];
  });
}
```

æŒæ¡åŸå‹é“¾ä¸ä»…å¸®åŠ©æˆ‘ä»¬ç†è§£JavaScriptçš„å¯¹è±¡ç³»ç»Ÿ, æ›´é‡è¦çš„æ˜¯è®©æˆ‘ä»¬èƒ½å¤Ÿå†™å‡ºæ›´é«˜æ•ˆã€æ›´å®‰å…¨ã€æ›´æ˜“ç»´æŠ¤çš„ä»£ç . åœ¨ç°ä»£JavaScriptå¼€å‘ä¸­, è™½ç„¶æœ‰äº†classè¯­æ³•ç­‰æ–°ç‰¹æ€§, ä½†åŸå‹é“¾ä»ç„¶æ˜¯åº•å±‚çš„æ ¸å¿ƒæœºåˆ¶, å€¼å¾—æ¯ä¸€ä¸ªå¼€å‘è€…æ·±å…¥æŒæ¡!